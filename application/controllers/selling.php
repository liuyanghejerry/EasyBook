<?phpclass Selling extends CI_Controller{         function __construct()    {         parent :: __construct();         $this -> load -> helper('html');		 $this->load->helper('url');		 $this->load->database();		 $this->load->library('pagination');		 //$this->load->library('javascript');		 //$this->output->cache(5);         }         function _makeHeader(&$data)    {         echo doctype('html5');        $data['keywords'] = 'This, is, keywords';        $data['description'] = 'This is description';        $data['robots'] = 'This is robots part';		$data['javascript'] = array(base_url().'resource/selling/jquery.easing.1.3.js',base_url().'resource/selling/jquery.accordion.js');		$data['css'] = array(base_url().'resource/common.css',base_url().'resource/footer/footer.css',base_url().'resource/selling/selling.css');		$data['username'] = $this->session->userdata('username');		$data['login'] = $this->session->userdata('login');    }         function index()    {          $this->page(0);		  //print_r($data['selling']);	    }		function page($pageNum = 0)	{		 $data = array();         $this -> _makeHeader($data);		 $config['base_url'] = site_url().'/selling/page';		 $config['total_rows'] = $this->_queryNum();		 $config['per_page'] = '10';          $this->pagination->initialize($config); 		 $data['pages'] = $this->pagination->create_links();		 $this ->_queryData($data, $pageNum);         $this -> load -> view('header', $data);         $this -> load -> view('selling');		 $this -> load -> view('footer');	}		 function _queryData(&$data, $page)	 {		$sql = "SELECT * FROM bk_selling ORDER BY selling_start LIMIT ?,?"; 		$query = $this->db->query($sql,array($page+0,$page+10));		$i = 0;		foreach ($query->result_array() as $row)		{		   $data['selling'][$i] = $row;		   $data['selling'][$i]['book_owner'] = $this->_queryOwner($data['selling'][$i]['book_ownerid']);		   $data['selling'][$i]['book_collage'] = $this->_queryCollage($data['selling'][$i]['book_collage']);		   $data['selling'][$i]['book_subject'] = $this->_querySubject($data['selling'][$i]['book_subject']);		   $i++;		}	 }	 	 function _queryNum()	 {		$sql = "SELECT COUNT(*) AS count FROM `bk_selling` WHERE `book_status` = 0";		$query = $this->db->query($sql);		return $query->row()->count;	 }	 	 function _queryOwner($id)	 {		$sql = "SELECT * FROM `bk_users` WHERE `user_id` = ? LIMIT 1";		$query = $this->db->query($sql,array($id));		return $query->row()->user_name;	 }	 	 function _queryCollage($id)	 {		$sql = "SELECT * FROM `bk_collages` WHERE `collage_id` = ? LIMIT 1";		$query = $this->db->query($sql,array($id));		return $query->row()->collage_name;	 }	 	 function _querySubject($id)	 {		$sql = "SELECT * FROM `bk_subjects` WHERE `subject_id` = ? LIMIT 1";		$query = $this->db->query($sql,array($id));		return $query->row()->subject_name;	 }    }?>